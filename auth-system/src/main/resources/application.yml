spring:
  application:
    name: okapi-auth-system
  datasource:
    url: jdbc:postgresql://localhost:${POSTGRES_PORT:5432}/${POSTGRES_DB:okapi_auth}
    username: ${POSTGRES_USER:okapi_service}
    password: ${POSTGRES_PASSWORD}
    driver-class-name: org.postgresql.Driver
  flyway:
    enabled: true
    locations: classpath:db/migration
  jpa:
    hibernate:
      ddl-auto: validate
    show-sql: true
    properties:
      hibernate:
        format_sql: true
        dialect: org.hibernate.dialect.PostgreSQLDialect
  security:
    oauth2:
      client:
        registration:
          okta:
            client-id: ${OIDC_CLIENT_ID}
            client-secret: ${OIDC_CLIENT_SECRET}
            scope: openid,profile,email
        provider:
          okta:
            # Do NOT use `issuer-uri` here because it triggers OIDC discovery at app startup.
            # Using explicit endpoints allows `bootRun` to start even if Keycloak isn't running.
            # Defaults target a local Keycloak realm when `OIDC_ISSUER_URI` is set.
            authorization-uri: ${OIDC_AUTHORIZATION_URI:${OIDC_ISSUER_URI}/protocol/openid-connect/auth}
            token-uri: ${OIDC_TOKEN_URI:${OIDC_ISSUER_URI}/protocol/openid-connect/token}
            user-info-uri: ${OIDC_USER_INFO_URI:${OIDC_ISSUER_URI}/protocol/openid-connect/userinfo}
            jwk-set-uri: ${OIDC_JWK_SET_URI:${OIDC_ISSUER_URI}/protocol/openid-connect/certs}

okapi:
  oidc:
    # Used as a stable provider identifier for DB lookups when `issuer-uri` is not configured.
    provider-id: ${OIDC_PROVIDER_ID:${OIDC_ISSUER_URI:local-oidc}}
    end-session-uri: ${OIDC_END_SESSION_URI:${OIDC_ISSUER_URI}/protocol/openid-connect/logout}
  jwt:
    issuer: ${OKAPI_JWT_ISSUER:okapi}
    secret: ${OKAPI_JWT_SECRET:dev-secret-change-dev-secret-change}
    ttl-seconds: ${OKAPI_JWT_TTL_SECONDS:600}
  authz:
    version: ${OKAPI_AUTHZ_VERSION:2026.01.26+dev}
  device:
    trust:
      ttl-days: ${OKAPI_DEVICE_TRUST_TTL_DAYS:30}
  break-glass:
    ttl-hours: ${OKAPI_BREAK_GLASS_TTL_HOURS:24}
  research:
    grant:
      ttl-days: ${OKAPI_RESEARCH_GRANT_TTL_DAYS:90}
#      saml2:
#        relying-party:
#          registration:
#            okapi-saml:
#              asserting-party:
#                metadata-uri: ${SAML_IDP_METADATA_URL}

server:
  port: ${SERVER_PORT:8080}
